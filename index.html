<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Enigma Cipher 2.0</title>

    <style>
      /* =============================================================
         üé® ENIGMA CIPHER 2.0 - Dark Blue / Gold Theme
         Author: Kyle Foster
         ============================================================= */

      :root {
        --primary-darkest: #0a105c;
        --primary-dark: #101a78;
        --primary-light: #1a258f;
        --grey-dark: #2a2a2a;
        --grey: #3e3e3e;
        --grey-light: #5a5a5a;
        --black: #000000;
        --white: #ffffff;
        --accent-gold: #d4af37;
        --accent-gold-light: #f4d67a;
        --text-light: #f8f8f8;
        --text-muted: #aaaaaa;
        --shadow-soft: 0 2px 8px rgba(0, 0, 0, 0.4);
        --transition-fast: 0.2s ease-in-out;
      }

      body {
        background: linear-gradient(
          145deg,
          var(--primary-darkest),
          var(--grey-dark)
        );
        color: var(--text-light);
        font-family: "Segoe UI", Roboto, sans-serif;
        margin: 1rem 2rem;
        padding: 0;
        height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }

      h1 {
        font-size: 2rem;
        letter-spacing: 1px;
        color: var(--accent-gold);
        text-shadow: 0 0 8px rgba(212, 175, 55, 0.5);
        margin-bottom: 0.75rem;
      }

      p.subtitle {
        color: var(--text-muted);
        font-size: 0.95rem;
        margin-top: 0;
        margin-bottom: 1.5rem;
      }

      main {
        background-color: rgba(10, 16, 92, 0.8);
        border: 1px solid var(--accent-gold);
        border-radius: 12px;
        box-shadow: var(--shadow-soft);
        padding: 1rem 2rem;
        width: 90%;
        max-width: 700px;
        display: flex;
        flex-direction: column;
        align-items: stretch;
        gap: 1rem;
      }

      textarea {
        background-color: var(--grey-dark);
        color: var(--text-light);
        border: 1px solid var(--grey-light);
        border-radius: 8px;
        padding: 0.75rem;
        resize: vertical;
        font-size: 1rem;
        min-height: 120px;
        transition: border var(--transition-fast),
          box-shadow var(--transition-fast);
      }

      textarea:focus {
        outline: none;
        border-color: var(--accent-gold);
        box-shadow: 0 0 8px rgba(212, 175, 55, 0.4);
      }

      .button-row {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 0.75rem;
        margin-top: 0.5rem;
      }

      button {
        background-color: var(--grey);
        color: var(--accent-gold);
        border: 1px solid var(--accent-gold);
        border-radius: 6px;
        padding: 0.6rem 1.25rem;
        cursor: pointer;
        font-size: 0.95rem;
        letter-spacing: 0.5px;
        font-weight: 500;
        transition: all var(--transition-fast);
      }

      button:hover {
        background-color: var(--primary-light);
        color: var(--white);
        box-shadow: 0 0 8px rgba(212, 175, 55, 0.5);
        transform: translateY(-1px);
      }

      button:active {
        transform: translateY(1px);
        opacity: 0.85;
      }

      footer {
        margin-top: 1rem;
        color: var(--text-muted);
        font-size: 0.85rem;
        text-align: center;
      }

      footer span {
        color: var(--accent-gold-light);
      }

      /* =============================================================
   ‚ÑπÔ∏è Info Button & Modal Help Section
   ============================================================= */

      .info-btn {
        position: sticky;
        top: 1rem;
        left: 85%;
        background: rgba(20, 25, 60, 0.2);
        color: var(--black);
        border: 1px solid var(--accent-gold);
        border-radius: 50%;
        width: 75px;
        height: 52px;
        font-size: 1.25rem;
        cursor: pointer;
        box-shadow: 0 0 8px rgba(212, 175, 55, 0.3);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        transition: all var(--transition-fast);
        z-index: 100;
      }

      .info-btn:hover {
        background: var(--accent-gold);
        color: var(--black);
        transform: scale(1.05);
        box-shadow: 0 0 12px rgba(212, 175, 55, 0.6);
      }

      /* Modal Base Styles */
      .modal {
        display: none;
        position: fixed;
        z-index: 99;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow-y: auto;
        background-color: rgba(0, 0, 0, 0.55);
        backdrop-filter: blur(6px);
        -webkit-backdrop-filter: blur(6px);
        padding-top: 60px;
      }

      /* Modal Inner Box */
      .modal-content {
        background: rgba(20, 25, 60, 0.85);
        border: 1px solid var(--accent-gold);
        color: var(--text-light);
        margin: auto;
        padding: 2rem;
        border-radius: 12px;
        width: 90%;
        max-width: 600px;
        box-shadow: 0 0 15px rgba(212, 175, 55, 0.25);
        animation: fadeIn 0.3s ease;
      }

      .modal-content h2 {
        color: var(--accent-gold);
        margin-top: 0;
      }

      .modal-content li {
        margin-bottom: 0.5rem;
      }

      .modal-content ol {
        margin-top: 0.3rem;
        margin-bottom: 1rem;
      }

      .close {
        color: var(--accent-gold);
        float: right;
        font-size: 1.5rem;
        font-weight: bold;
        cursor: pointer;
        transition: color var(--transition-fast);
      }

      .close:hover {
        color: var(--accent-gold-light);
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @media (max-width: 500px) {
        main {
          padding: 5rem 1.25rem 1.25rem;
        }

        textarea {
          font-size: 0.9rem;
        }

        button {
          flex: 1 1 45%;
        }
      }
    </style>
  </head>

  <body>
    <!-- Info Button -->
    <button
      type="button"
      id="infoButton"
      class="info-btn"
      title="How to use Enigma"
    >
      ‚ùî
    </button>

    <!-- Modal Help Section -->
    <div id="helpModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>How to Use Enigma</h2>
        <ul>
          <li>
            <strong>Encrypting text:</strong>
            <ol>
              <li>
                Enter the text you wish to encrypt in the ‚ÄúInput‚Äù section.
              </li>
              <li>Double click the text box or click the ‚ÄúEncrypt‚Äù button.</li>
              <li>The encrypted text appears in the ‚ÄúOutput‚Äù section.</li>
              <li>Click the ‚ÄúCopy to clipboard‚Äù button to copy your result.</li>
            </ol>
          </li>
          <li>
            <strong>Decrypting text:</strong>
            <ol>
              <li>Enter the encrypted text in the ‚ÄúInput‚Äù section.</li>
              <li>Double click the text box or click the ‚ÄúDecrypt‚Äù button.</li>
              <li>The decrypted text appears in the ‚ÄúOutput‚Äù section.</li>
            </ol>
          </li>
        </ul>
      </div>
    </div>

    <header>
      <h1>Enigma Cipher 2.0</h1>
      <p class="subtitle">
        Encrypt, decrypt, and conceal your messages with style.
      </p>
    </header>

    <main>
      <label for="textInput">Your Message:</label>
      <textarea
        id="textInput"
        placeholder="Type or paste your text here..."
      ></textarea>

      <div class="button-row">
        <button type="button" id="encrypt">Encrypt</button>
        <button type="button" id="decrypt">Decrypt</button>
        <button type="button" id="copyButton">Copy</button>
        <button type="button" id="pasteButton">Paste</button>
      </div>

      <label for="output">Output:</label>
      <textarea
        id="output"
        readonly
        placeholder="Result will appear here..."
      ></textarea>
    </main>

    <footer>¬© <span>2025</span> Enigma Cipher by Kyle Foster</footer>

    <script>
      /**
       * =============================================================
       * Enigma Cipher 2.0 - Core Cipher + UI Controller
       * -------------------------------------------------------------
       * Author: Kyle Foster
       * Description:
       *   Implements a multi-layer Caesar-style cipher with dynamically
       *   rotating alphabets and an interactive UI for encryption and
       *   decryption operations.
       *
       *   Features:
       *   - Multi-level alphabet sets (v1‚Äìv9)
       *   - Dynamic "magic number" system for unique cipher shifts
       *   - Automatic tag-based decryption recognition
       *   - Full clipboard integration (copy/paste)
       *   - Double-click smart decrypt/encrypt on input box
       * =============================================================
       */

      /* -------------------------------------------------------------
       * üîê Cipher Core
       * ------------------------------------------------------------- */

      // --- Alphabet sets ---
      const aSet = [
        "J`1j'2]{WOsy#\"PGL;&Ig:6DK,Q%NkT>4V=[09mdn*S@xc-<^Y$?(BF7qvEtreh\nH.aM5_!3i8X)AUCo\rfulpb~+Z}/z Rw",
        "0q.C_p1,wj\"@Fk\nd>L)$;8zJt+fAE*Ga297!Q=/h%N`VxY'M~KR:3&mv4BobWy}^DgZ?U\r IPs[HOcrn#6i<TSX]-e5{l(u",
        "$L0RTm~o_FuW%bk\n\rMwd(Q/[-G,a`5NJ)DAf:+ ]?@thEx*#ZO=4U7vIPr>lHsnX;e<i&Y\"9Sy3qz1^!BKj'cg{Vp2.}86C",
        "$]7(Sw *Q>D.hY\"[NRIu^G<_yK12:qXiCgb3\npUlLn9E)0J=kHvT-4~f@5}%s`e+PZ';WFo?/txA,zda#B68\r!m&{crMVOj",
        "\"{4c+fe2P`XYznt9.%:M^[K;'OgNF1dI6Qi#amj0xyA(pHG]5Uw3\n_sLRoVb\r}~$W!k8-*/rC?&hZv7@)=luDE>SJBTq< ,",
      ];
      const bSet = [
        "jf3i)<@#Tu{mYK;ML:\n]Wts\"c1XOIrUNk_6bVpE7>Sy`+d&8qRz^nxG?P*[2Hv%w$=g!\rD}ae~Q40,9Z. AC(l'/hJ5BF-o",
        "/#0_f^\"Z6YP&Sy.Or\n?*1Mv$8<gio,cUD)[p@!3Kz=2k]jd`Qa4m5GshE%9eAV\r(qNwu:Htlx-} 7R;BW>b'{ILCJTF+n~X",
        "+Mws^HiD'uBjF1\"I&{RV@vTL_Z%aG0!E.g=t*:? 8SyQ`n~#]5ef\r/(;x3JbYAK2hcm-Uqd<W[}ko,NXCPp>4)z9rO\n$76l",
        ")<MqmrDJ;/knAL@1I +(WTC#2g\r8lBFZ.z:-V$R6uoHe*cw=3'vE[hU5d\"aYP^_?9Q,7S0Nfjb&{Xsx}O]%4>p\n`!KGyti~",
        "K0~{C39\nxj@,HR*5sSp6yn_(%m2AIL/O+8<lFg)>qkDdGhfJu-MZ;$.:t4Wv} co\r#=a1Ei^[\"U&Q]VB?z!eXwTNr'7YbP`",
      ];
      const cSet = [
        "B(d5n{?;S-1r}M*h9<wA!/oe\nWZf2`>H+G,J)vcNKxg&yYFE3m^jIl40#s_]p~TuQ8C\"[\r' VO.=$Li@z:6atU%PRD7bkXq",
        "kAo!9TD,JpH7(i)dB6fM0;^=`E~Y{$_R:sWXcZ]>?mtU/rS qj'vQg2hb.&<L1GuN%3I8}@yez\"-O#*C5\rVP\n[xl4Fn+awK",
        "?M#tVRK\"%cA.)='~`;eLoJEU0TzBg:4vj}Z6qpw<nNDdi]@fX\rQh1!bs9u+kmWy/>G{axIS\n(YP^_$8l-F*C2&7[r5 HO3,",
        ")Q7YW\rd_.!8;Z-%1PKUA'XVtCz9he$6mNvcpaSgLkyi}l,~M0j[O*f{5^F=\"rn3/\n<D:oER4`u+q(wBG?sbH2&Jx @>T]#I",
        ",kH3QWMfV_+.u]t\"NC}`Yw\rz~v a^-ro0nc1l;e4/GS2UE)ZOP$jg5dAxi%yLp*{#bIsB8<R(&T!X'=6DhK\n?:J9@7m[>Fq",
      ];
      const dSet = [
        "Bi@l+S4o*aL I:bAhv~^D#9)q{3,uPWpwN]7-O52fCE\r>crdXJ}t\nge/`MHnV_?0.s6UYG<z['y!j$\"Q=8K;kTRx&(mF%Z1",
        "uEMU~:4R+g_&BL*[Ff!}>T7VG{rzX)P;9=^5(qx'.3] O@meKWt\"wSsQ2\rjlphYbC\noiJNAD<8Z-0Hky?/d,I`1vnc$%#a6",
        "Mf6Qhu\"3,'tg9#!85?pNSH2< zakcobq*{vxP+7&_.j;FV`T0^nDy1E>mJ~B/]$A\rUdeK\nRrIL@4Y[G)l:swXZ-(Oi}C%=W",
        "oP@!R'-ST>~a^YN;pH%uwes2V\n9k*#W}BiX 6{\r=,]\"(l_?MUt)$dDErqIF&35QxLZz4J8O[7+K:Cyb0vG<hmAc1ngf`j/.",
        "\"Y!JO d(,AxE9Sm5fq>y7Z^]\rV?0DBj&N}-C<`sU2hFnX/GL@RWMKI.*P8;#)ui3'rQcgp=:$a61lb4wzH\n+~vt[{eT_o%k",
      ];
      const eSet = [
        "BPo=\r<X_Kfg )iET:p86`bHO/dhSZNac^VCw?rF}elU'%@u4[j]{D0&y7+2,Iv.5sRnqmkJM>AW*\n\"tYxG-~1(!;3$zQL9#",
        "bTkD<X5zIp?wFiCK,Pv-QR/':~4Aha$nWG*1gL63N}fslJY+y^\n;U!8o2\rS([jH&\"Z]m%uc`V#rt) BM_e{qE>0O7=9.d@x",
        "\",6g)X8\r03![YV>n2hAQW;qmN<-49z5ke$Kf+GtC@1R{i}v=:*~xOMr'uwJSy_ljUDbo%#sZTI]E\nd(`^/?B&.PcLapH F7",
        '>(,`SKoshY4J{D1)pEed$l;3}Bk#/L6n\rQU^N7.!-rmizwf]u_Ov+b~TR025:yqgH&FVPIWx*Cj? aZM%@\n8=GAtX[<"9c',
        "n<_\n#)3$mT8%{XSt!MuA^V56Bcr2J.FxHlZo?(\"\rE*/zwaO@9`]f7q&+0N'} RjGCI;YbgD1>~LhsW-y:QUKP[d4epvi,k=",
      ];

      const v1 = aSet;
      const v2 = bSet;
      const v3 = cSet;
      const v4 = dSet;
      const v5 = eSet;
      const v6 = [...v1, ...v2];
      const v7 = [...v1, ...v2, ...v3];
      const v8 = [...v1, ...v2, ...v3, ...v4];
      const v9 = [...v1, ...v2, ...v3, ...v4, ...v5];
      const alphabets = [v1, v2, v3, v4, v5, v6, v7, v8, v9];

      const encryptionTags = Array.from(
        { length: 9 },
        (_, i) => `[EN_V${i + 1}]`
      );

      /**
       * Convert a numeric code into a hash value between 1‚Äì9.
       * @param {number|string} code - Input numeric code.
       * @returns {number|null} - A hash between 1‚Äì9, or null if invalid.
       */
      function hashToDigit(code) {
        const str = String(code).padStart(3, "0");
        const num = parseInt(str, 10);
        if (num < 5 || num > 999) return null;

        let hash = 0;
        for (let i = 0; i < str.length; i++) {
          hash = (hash * 31 + str.charCodeAt(i)) % 9;
        }
        return hash + 1;
      }

      /**
       * Encrypts or decrypts a given text using a multi-rotating Caesar cipher.
       * Each encryption appends a unique tag containing a random "magic number"
       * and version identifier, allowing automatic decryption later.
       *
       * @param {string} text - The text to encrypt or decrypt.
       * @param {boolean} [encrypt=true] - If true, encrypts; if false, decrypts.
       * @returns {string} - Encrypted or decrypted text.
       */
      function encryptAndDecrypt(text, encrypt = true) {
        if (typeof text !== "string") return text;
        console.log("Enigma 2.0 start:", { encrypt, text });

        // --- Helper: generate random 3-digit number ---
        function generateMagicNumber() {
          const number = Math.floor(Math.random() * (999 - 5 + 1)) + 5;
          return { string: number.toString().padStart(3, "0"), number };
        }

        let magicNumber,
          resultText = "",
          ENCRYPTION_TAG,
          tagIndex;

        if (!encrypt) {
          // üîç Use regex to extract [XXX[EN_VY]]
          const match = text.match(/\[(\d{3})\[EN_V(\d)\]\]$/);
          if (!match) {
            console.warn("No valid encryption tag found. Skipping decryption.");
            return text;
          }

          const magicStr = match[1];
          const tagNum = parseInt(match[2], 10);
          magicNumber = { string: magicStr, number: -parseInt(magicStr, 10) };
          ENCRYPTION_TAG = `[EN_V${tagNum}]`;
          tagIndex = tagNum - 1;
          text = text.replace(match[0], "");
        } else {
          // üîê Encryption mode
          tagIndex = Math.floor(Math.random() * 9);
          ENCRYPTION_TAG = encryptionTags[tagIndex];
          magicNumber = generateMagicNumber();

          if (text.includes(ENCRYPTION_TAG)) {
            console.log("Text already encrypted:", text);
            return text;
          }
        }

        const alphabetLists = alphabets[tagIndex];
        const totalAlphabets = alphabetLists.length;

        for (let i = 0; i < text.length; i++) {
          const char = text[i];
          const currentAlphabet = alphabetLists[i % totalAlphabets];
          const index = currentAlphabet.indexOf(char);

          if (index !== -1) {
            let newIndex =
              (index + magicNumber.number) % currentAlphabet.length;
            if (newIndex < 0) newIndex += currentAlphabet.length;
            resultText += currentAlphabet[newIndex];
          } else {
            resultText += char;
          }
        }

        if (encrypt) resultText += `[${magicNumber.string}${ENCRYPTION_TAG}]`;

        console.log(`${encrypt ? "Encryption" : "Decryption"} complete.`, {
          resultText,
          magicNumber,
          ENCRYPTION_TAG,
        });

        return resultText;
      }

      /* -------------------------------------------------------------
       * üß≠ UI Controller (DOM Interactions)
       * ------------------------------------------------------------- */

      /**
       * Handles all DOM bindings and user interactions for the Enigma Cipher UI.
       * @class
       */
      class EnigmaUI {
        constructor() {
          /** @type {HTMLTextAreaElement} */
          this.textInput = document.getElementById("textInput");
          /** @type {HTMLTextAreaElement} */
          this.outputArea = document.getElementById("output");

          /** @type {HTMLButtonElement} */
          this.encryptButton = document.getElementById("encrypt");
          /** @type {HTMLButtonElement} */
          this.decryptButton = document.getElementById("decrypt");
          /** @type {HTMLButtonElement} */
          this.copyButton = document.getElementById("copyButton");
          /** @type {HTMLButtonElement} */
          this.pasteButton = document.getElementById("pasteButton");
          /**
           * Display the Help Modal when the info button is clicked.
           */
          /** @type {HTMLButtonElement} */
          this.modal = document.getElementById("helpModal");
          /** @type {HTMLButtonElement} */
          this.infoButton = document.getElementById("infoButton");
          /** @type {HTMLSpanElement} */
          this.closeBtn = document.querySelector(".close");

          this.bindEvents();
        }

        /** Bind all event listeners. */
        bindEvents() {
          this.encryptButton.addEventListener("click", () => this.encrypt());
          this.decryptButton.addEventListener("click", () => this.decrypt());
          this.copyButton.addEventListener("click", () => this.copyOutput());
          this.pasteButton.addEventListener("click", () => this.pasteInput());
          this.textInput.addEventListener("dblclick", () => this.autoMode());
          // Open modal
          this.infoButton.addEventListener("click", () => {
            console.log("Show info modal", this.modal);
            this.modal.style.display = "block";
            this.infoButton.style.display = "none";
          });

          // Close when 'x' is clicked
          this.closeBtn.addEventListener("click", () => {
            console.log("Close info modal");
            this.modal.style.display = "none";
            console.log(this.modal);
            this.infoButton.style.display = "block";
          });
        }

        /** Encrypt the current input text and display output. */
        encrypt() {
          const text = this.textInput.value.trim();
          this.outputArea.value = encryptAndDecrypt(text, true);
        }

        /** Decrypt the current input text and display output. */
        decrypt() {
          const text = this.textInput.value.trim();
          this.outputArea.value = encryptAndDecrypt(text, false);
        }

        /** Automatically encrypt or decrypt based on tag presence. */
        autoMode() {
          const text = this.textInput.value;
          if (text.endsWith("]")) this.decrypt();
          else this.encrypt();
        }

        /** Copy current output to clipboard. */
        async copyOutput() {
          try {
            await navigator.clipboard.writeText(this.outputArea.value);
            console.log("‚úÖ Copied to clipboard.");
          } catch (err) {
            console.error("Clipboard copy failed:", err);
          }
        }

        /** Paste clipboard contents into the input field. */
        async pasteInput() {
          try {
            const text = await navigator.clipboard.readText();
            this.textInput.value = text;
            console.log("üìã Pasted from clipboard.");
          } catch (err) {
            console.error("Clipboard paste failed:", err);
          }
        }
      }

      // Initialize UI once DOM is ready
      document.addEventListener("DOMContentLoaded", () => {
        window.enigmaApp = new EnigmaUI();
      });
    </script>
  </body>
</html>
