<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Enigma Cipher</title>
    <!-- Favicon -->
    <link
      rel="shortcut icon"
      href="/Enigma/EnigmaLogo.png"
      type="image/x-icon"
    />
    <link rel="icon" href="/Enigma/EnigmaLogo.png" type="image/x-icon" />
    <!-- SEO & Metadata -->
    <meta
      name="description"
      content="Encrypt and decrypt messages instantly with Enigma Cipher ‚Äî a modern cipher tool inspired by the classics."
    />
    <meta
      name="keywords"
      content="encryption, cipher, Enigma, decryption, encrypt tool, secure text, cipher app, online encrypter, decode messages"
    />
    <meta name="author" content="Kyle Foster" />
    <meta name="robots" content="index, follow" />

    <!-- Open Graph for social sharing -->
    <meta property="og:title" content="Enigma Cipher" />
    <meta
      property="og:description"
      content="A sleek modern cipher app for encrypting and decrypting text."
    />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://foscat.github.io/Enigma/" />
    <meta
      property="og:image"
      content="https://foscat.github.io/Enigma/EnigmaLogo.png"
    />

    <!-- Reset css to make pages viewable on all browsers -->
    <link
      rel="stylesheet"
      type="text/css"
      media="screen"
      href="/Enigma/reset.css"
    />

    <style>
      /* =============================================================
         üé® ENIGMA CIPHER 2.0 - Dark Blue / Gold Theme
         Author: Kyle Foster
         Purpose: Provides elegant, high-contrast styling optimized 
         for clarity, accessibility, and visual balance.
         ============================================================= */

      /* =============================================================
         üåà THEME VARIABLES
         - Centralized color and style configuration.
         - Uses deep blues, gold, and neutral greys for a refined look.
         ============================================================= */
      :root {
        --primary-darkest: #0a105c; /* Deep navy base for backgrounds */
        --primary-dark: #101a78; /* Slightly lighter blue for depth */
        --primary-light: #1a258f; /* Accent blue for hover and focus */
        --grey-dark: #2a2a2a; /* Main grey tone for panels or inputs */
        --grey: #3e3e3e; /* Button and neutral elements */
        --grey-light: #5a5a5a; /* Borders and lighter UI details */
        --black: #000000; /* Base black for contrast */
        --white: #ffffff; /* Used for text and highlights */
        --accent-gold: #d4af37; /* Primary accent - gold */
        --accent-gold-light: #f4d67a; /* Softer gold for hover and glow */
        --text-light: #f8f8f8; /* Default text color on dark bg */
        --text-muted: #aaaaaa; /* Secondary text tone */
        --shadow-soft: 0 2px 8px rgba(0, 0, 0, 0.4); /* Subtle shadows for depth */
        --transition-fast: 0.2s ease-in-out; /* Consistent transition timing */
        font-size: 1rem;
      }

      /* =============================================================
   üß≠ GLOBAL LAYOUT
   - Creates centered flex layout with smooth gradient background.
   ============================================================= */
      body {
        background: linear-gradient(
          145deg,
          var(--primary-darkest),
          var(--grey-dark)
        );
        color: var(--text-light);
        font-family: "Segoe UI", Roboto, sans-serif;
        margin: 1rem 2rem;
        padding: 0;
        height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }

      /* =============================================================
   üè∑Ô∏è HEADINGS
   - Golden accent titles and clean spacing hierarchy.
   ============================================================= */
      h1 {
        font-size: 2rem;
        letter-spacing: 1px;
        color: var(--accent-gold);
        text-shadow: 0 0 8px rgba(212, 175, 55, 0.5);
        margin-bottom: 0.75rem;
        text-align: center;
      }

      h3 {
        font-size: 1.5rem;
      }

      p.subtitle {
        color: var(--text-muted);
        font-size: 0.95rem;
        margin-top: 0;
        margin-bottom: 1.5rem;
      }

      /* =============================================================
   üì¶ MAIN CONTAINER
   - Core interface panel with rounded edges and frosted glass effect.
   ============================================================= */
      main {
        background: rgba(26, 37, 143, 0.2); /* frosty blue base */
        backdrop-filter: blur(16px) saturate(180%);
        -webkit-backdrop-filter: blur(16px) saturate(180%);
        border: 1px solid rgba(212, 175, 55, 0.25);
        border-radius: 16px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
        padding: 2rem;
        width: 90%;
        max-width: 1000px;
        display: flex;
        flex-direction: column;
        align-items: stretch;
        gap: 1rem;
      }

      /* =============================================================
   ‚úçÔ∏è TEXTAREAS
   - Dark input fields with stronger frosted effect and gold glow on focus.
   ============================================================= */
      textarea {
        background: rgba(
          255,
          255,
          255,
          0.05
        ); /* translucent for frosted effect */
        color: var(--text-light);
        width: 95%; /* expanded to 80% of parent */
        margin: 10px auto; /* center horizontally */
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 12px;
        padding: 1rem;
        resize: vertical;
        font-size: 1rem;
        min-height: 120px;
        transition: border var(--transition-fast),
          box-shadow var(--transition-fast), background var(--transition-fast);
      }

      textarea:focus {
        outline: none;
        border-color: var(--accent-gold);
        background: rgba(255, 255, 255, 0.1);
        box-shadow: 0 0 12px rgba(212, 175, 55, 0.5);
      }

      /* =============================================================
   üîò BUTTON STYLES
   - Glassy buttons with gold glow and hover pop effect.
   ============================================================= */
      .button-row {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 0.75rem;
        margin-top: 0.5rem;
      }

      button {
        background: rgba(255, 255, 255, 0.08); /* subtle glass effect */
        color: var(--accent-gold);
        border: 1px solid rgba(212, 175, 55, 0.3);
        border-radius: 12px;
        padding: 0.6rem 2.25rem;
        cursor: pointer;
        font-size: 1.25rem;
        font-weight: 500;
        letter-spacing: 0.5px;
        backdrop-filter: blur(6px);
        -webkit-backdrop-filter: blur(6px);
        transition: all var(--transition-fast);
      }

      button:hover {
        background: rgba(212, 175, 55, 0.2);
        color: var(--white);
        box-shadow: 0 4px 16px rgba(212, 175, 55, 0.5);
        transform: translateY(-1px);
      }

      button:active {
        transform: translateY(1px);
        opacity: 0.85;
      }

      button:focus {
        outline: 2px solid var(--accent-gold-light);
        outline-offset: 2px;
      }

      /* =============================================================
   üìú FOOTER
   - Muted tone with golden highlights.
   ============================================================= */
      footer {
        margin-top: 1rem;
        color: var(--text-muted);
        font-size: 0.85rem;
        text-align: center;
      }

      footer span {
        color: var(--accent-gold-light);
      }

      /* =============================================================
   ‚ÑπÔ∏è INFO BUTTON & MODAL
   - Provides a clean help overlay with fade-in animation.
   ============================================================= */
      .info-button {
        position: sticky;
        top: 1rem;
        left: 90%;
        padding: 5px;
        background: rgba(20, 25, 60, 0.25);
        color: var(--black);
        border: 1px solid var(--accent-gold);
        border-radius: 50%;
        width: 40px;
        font-size: 1rem;
        cursor: pointer;
        box-shadow: 0 0 12px rgba(212, 175, 55, 0.35);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        transition: all var(--transition-fast);
        z-index: 100;
      }

      .info-btn:hover {
        background: rgba(212, 175, 55, 0.25);
        color: var(--black);
        transform: scale(1.05);
        box-shadow: 0 0 18px rgba(212, 175, 55, 0.6);
      }

      /* Modal Base Styles */
      .modal {
        display: none;
        position: fixed;
        z-index: 99;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow-y: auto;
        background-color: rgba(0, 0, 0, 0.55);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        padding-top: 30px;
      }

      /* Modal Inner Box */
      .modal-content {
        background: rgba(20, 25, 60, 0.85);
        border: 1px solid rgba(212, 175, 55, 0.35);
        color: var(--text-light);
        margin: auto;
        padding: 2rem;
        border-radius: 16px;
        width: 90%;
        max-width: 600px;
        box-shadow: 0 0 24px rgba(212, 175, 55, 0.3);
        animation: fadeIn 0.3s ease;
      }

      .modal-content h2 {
        color: var(--accent-gold);
        margin-top: 0;
        font-size: 1.75rem;
        margin-bottom: 10px;
      }

      .modal-content h3 {
        color: var(--accent-gold);
        margin-top: 0;
        font-size: 1.5rem;
        margin-bottom: 10px;
      }

      .modal-description {
        font-size: 1rem;
        margin: 10px 0 20px;
      }

      .modal-content li {
        margin-bottom: 0.5rem;
      }

      .modal-content ol {
        margin-top: 0.3rem;
        margin-bottom: 1rem;
        margin-left: 2rem;
        list-style-type: decimal;
      }

      .modal-note {
        font-size: 0.9rem;
        color: var(--text-muted);
        background-color: var(--primary-darkest);
        padding: 5px 10px;
        border: 1px solid var(--accent-gold-light);
      }

      .close {
        color: var(--accent-gold);
        margin-left: 85%;
        padding: 0.5rem 1.25rem;
        font-size: 1.5rem;
        font-weight: bold;
        cursor: pointer;
        transition: color var(--transition-fast);
      }

      .close:hover {
        color: var(--accent-gold-light);
      }

      /* =============================================================
   ‚ú® ANIMATIONS & RESPONSIVE
   ============================================================= */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @media (max-width: 500px) {
        main {
          padding: 3rem 1.25rem 1.25rem;
        }

        textarea {
          font-size: 0.9rem;
        }

        button {
          flex: 1 1 45%;
        }
      }
    </style>
  </head>

  <body>
    <!-- ‚ÑπÔ∏è Information Button (opens the Help Modal) -->
    <button
      id="infoButton"
      class="info-button"
      aria-label="Open help and instructions"
      title="How to use Enigma"
    >
      <span aria-hidden="true">‚ùî</span>
    </button>

    <!-- üß≠ Help Modal -->
    <div
      id="helpModal"
      class="modal"
      aria-hidden="true"
      role="dialog"
      aria-modal="true"
    >
      <div class="modal-content" role="document" tabindex="-1">
        <!-- Close Button -->
        <button class="close" aria-label="Close help window">&times;</button>

        <h2 id="helpTitle">How to Use Enigma</h2>
        <p class="modal-description">
          Enigma is a text encryption and decryption utility. You can enter text
          into the
          <strong>Input</strong> box and either double-click the box or use the
          <strong>Encrypt</strong> and <strong>Decrypt</strong> buttons to
          process your text.
        </p>

        <hr />

        <section aria-labelledby="encryptGuide">
          <h3 id="encryptGuide">Encrypting Text</h3>
          <ol>
            <li>
              Enter your desired text in the <strong>Input</strong> section.
            </li>
            <li>
              Double-click the input box or click the
              <strong>Encrypt</strong> button.
            </li>
            <li>
              Your encrypted result will appear in the
              <strong>Output</strong> box.
            </li>
            <li>
              Click <strong>Copy to Clipboard</strong> to copy your result.
            </li>
          </ol>
        </section>

        <section aria-labelledby="decryptGuide">
          <h3 id="decryptGuide">Decrypting Text</h3>
          <ol>
            <li>
              Paste or type the encrypted text in the
              <strong>Input</strong> section.
            </li>
            <li>
              Double-click the box or click the <strong>Decrypt</strong> button.
            </li>
            <li>
              The decrypted message will appear in the
              <strong>Output</strong> section.
            </li>
          </ol>
        </section>

        <p class="modal-note">
          üí° <strong>Tip:</strong> Enigma auto-detects whether to encrypt or
          decrypt based on your input.
        </p>
      </div>
    </div>

    <header>
      <h1>Enigma Cipher</h1>
      <p class="subtitle">
        Encrypt, decrypt, and conceal your messages with style.
      </p>
    </header>

    <main>
      <!-- Input Section -->
      <section aria-labelledby="inputLabel">
        <h3 id="inputLabel">Input</h3>
        <div class="button-row">
          <!-- Copies text content from clipboard and pastes it in input box. -->
          <button
            id="pasteButton"
            type="button"
            aria-label="Paste text from clipboard"
          >
            üìã Paste
          </button>
        </div>
        <textarea
          id="textInput"
          name="inputArea"
          title="Text Input Area"
          placeholder="Insert text here"
          aria-describedby="inputHelp"
        ></textarea>
      </section>

      <!-- Output Section -->
      <section aria-labelledby="outputLabel">
        <h3 id="outputLabel">Output</h3>
        <div class="button-row">
          <!-- Copies text content and saves it to the clipboard. -->
          <button
            id="copyButton"
            type="button"
            aria-label="Copy output to clipboard"
          >
            üßæÔ∏è Copy
          </button>
        </div>
        <textarea
          id="output"
          name="outputArea"
          title="Text Output Area"
          placeholder="Output text appears here"
          readonly
        ></textarea>
      </section>

      <!-- Encrypt / Decrypt Buttons -->
      <div class="button-row">
        <button
          id="encrypt"
          type="button"
          aria-label="Encrypt the entered text"
        >
          ü™Ñ Encrypt
        </button>
        <button
          id="decrypt"
          type="button"
          aria-label="Decrypt the entered text"
        >
          üîÆ Decrypt
        </button>
      </div>
    </main>

    <footer>&copy; <span>2025</span> Enigma Cipher by Kyle Foster</footer>

    <script>
      /**
       * =============================================================
       * Enigma Cipher 2.0 - Core Cipher + UI Controller
       * -------------------------------------------------------------
       * Author: Kyle Foster
       * Description:
       *   Implements a multi-layer Caesar-style cipher with dynamically
       *   rotating alphabets and an interactive UI for encryption and
       *   decryption operations.
       *
       *   Features:
       *   - Multi-level alphabet sets (v1‚Äìv9)
       *   - Dynamic "magic number" system for unique cipher shifts
       *   - Automatic tag-based decryption recognition
       *   - Full clipboard integration (copy/paste)
       *   - Double-click smart decrypt/encrypt on input box
       * =============================================================
       */

      /* -------------------------------------------------------------
       * üîê Cipher Core
       * ------------------------------------------------------------- */

      // --- Alphabet sets ---
      const aSet = [
        "jvb\\(M_}7GZh[cAK+<P>FH;w6$VTpq{#m5O8LEDu4&,:]I!~QRBY3*/txn\n" +
          "9`2?f)=1e%\"W0J.-@'gisl^rSCXkaodyzU|N",
        "o7m!UjD49'#W}N|&Rx,*Vq?\"va2fuc(giytB~=bd>\\.K;Ms{z@G<O)r5hAEC:1`L+^-8PZS\n" +
          "lYp[e$k/wT%H03IJXnQ6F]_",
        `,&sUM)4JE6^$C{N'VfSdTumX;eo#r"Q\n` +
          "Y[O+|R73%5@Fz9GxAK*0>vD1-]nI~ykj_!q(w2}Pib.c<?\\BaLh/gWp:HZlt`8=",
        "5b7\\X1!+$4HhI*_nQzoO]t`SK6J)xGy?/A=-{YEpBi8~>C9jdq|M[LZNslf@\".R,gk%vTw(^<2'FD3a&m;:rcPe#\n" +
          "0VUWu}",
        "emAC#J&r-nUcRT<(Dx5w>Q]XZz)349d'K\"F:!?j7Lo*[vNVfPM0sW{@E_YqpBHgy|OilI`\n" +
          "GS.6k^}a/;2~$u+%=8h,b\\1t",
      ];
      const bSet = [
        '4|}z0VTNIsx1.Ubhn:"dCAc=56+Rva^F2HYm8-(rt%*Q&Z`_S9>pGX!BL/kM;D{l]j\\\n' +
          "eJ'@w<~u?3#Kfq$)P[EO,7yogiW",
        "~b7OR5m#+W-!LAd?GeDQZq:_=PaM$;.@nI^y<9S[Yig{\n" +
          "t,%'1j*}`VlrEfhpwckz4\\3U/620vK)o\"|T>XC]sxuJFH&(NB8",
        "@9I`G=#N{!e3blkF)cB,tPEL\"(d*KV~vo]&4fZsr;5Xw}Tagm'.[6YznMp1j0ihy^+AD8xJu\n" +
          "|CH>$_W7OR:%Q\\<2-q/US?",
        'v9ZiI0}<3wPd":_{JVDTWXFG7CmL?B;NRSy#1n)u=2zK6\n' +
          "^]\\U!HEg$k8p'aqx[AjY%>Q-eb+/f4&s~l,|`*c5@t(oOhM.r",
        `QvOkPH|+d>_#N^x5oSz41)Us9fbA,?ig0=@&ZYIX'D[GlV{/t!:KTjWR"wqyn\\pM7JL~6cre8Bamh\n` +
          "(C$*}.<u2%-]`3FE;",
        '{tP.@"*\\]wkMlW!seZEaT}v-q97y~:146H_NoKxmc$?hJI\n' +
          "|g2VnL'(U0fiuDb^&F=#,d/BzQ><XS%R5j[GO`r8Ap)Y3;+C",
      ];
      const cSet = [
        "93`#:/pbjt;uA7C*<v\\oU6P8^4Si&]\n" +
          `Nw$=-Q@yLac[E5XVxe{0Y%2Mm+?Tg1KHs|h"Z)>k}OWFqJRD.Gdlr('f_B,nI~z!`,
        `$~YHT+P)a5qF'GD"N!@?i8.-X32\n` +
          "WCSRzx1L,\\_[V]l;My(`<7*ro}4Q=d/pgAfm6JkuZ#Bb%Iwj>O{e&sch9U:|0vnK^Et",
        'UBCi[NV=JbtIp7!dYj:S|-,L@k4s{lrq}O1^T)*uHR+a;%&$o3QEhcA"v\n' +
          "KDP]9fZnWe5Xy'g(F_0.28MG6\\wmx#?<`~/>z",
        "'e3]Z>SC$:Byf;9&z=O\\^vq[XT(dY0`)8,F.?5Ps-l/p<7nL1Kc_Ew+x*@h4%|H#t6\"IjDkiGmRb~2NWg\n" +
          "a{ru}!UAQoVJM",
        '_;Dp3*%MWI!s}jQbh@8UeFziEk[BR<1SgZaHG"#>4{Tom26tnAw\\:Y&~v)q0$xXc.y(l?9\n' +
          "u-dJ|f5^LCOrN],V+`P7K='/",
        "A)#3iY'L;X1,dSQgV7w%er?[2P]k&F6>=I/:0bap9vj\n" +
          'n^JyMf$G_5Hh.xZT"KO|cU({q!N*o\\t@8`z-u4WlCRB<+mEs~D}',
      ];
      const dSet = [
        'W|gvPy+3?~nw"\n' +
          "zA*Sib2LhImkl.pfcr[,!U}j&H48d5XVs$<(9=ea^Y]'`%_RMZq#>{;EJx@D0oG1Ku6Q:-\\tC7NTF)OB/",
        `/LC*E[Ou8?$o'"pNKj9XJ~3ihMs(Bbv4\n` +
          "}^w:{al&#,HRe\\m<IAtP0f2|Qzk.`+y5cFGZ@DWnqSgU6]dV>=7%xT!_1Y)r-;",
        "os;:i{=w1J}u*rqlI#)EzA2~$0<v?_K5V,WM8xS(b9Qc%k@a/dRj74XYf3p'n>LD.Cmg\n" +
          'B`hy+P-e^|"]O!tZT\\UF[H6&GN',
        "\"GnpS4$u^T:j<WVU=13{QaL.c+0bZRO)\\|!r6;wot`E'q?x8di_>sYl\n" +
          "]FHk,Nh2I}CJ5-@*9Mg%&7#Kmv~XeBA/[(fyPDz",
        'o2}>j?":W!ek.f-L=yO6Y(CdmZawgrsDP\n' +
          "<#T;`v+h$Eqpz9M&UX{n@t/*[c73~B)S_R%Ju'Ix810A,QHV4i^\\GbF]l|KN5",
      ];
      const eSet = [
        `p,sNO<]C$Y|tEuzZ@"\\#MxJ=G9WD}{i!Sl)2&;T>BP50kXo+v'f_3hn-K[48R/.QVgymA6b~Urc^?w%7\n` +
          "jH(FaL:e*`qI1d",
        "0mCzSs}Mwdv@NfH_Qbn=9;GR?q~OTFa\\J\"BKc8Yh#lgI*,XZ7<k/(UtA^uD&jep!W'i:+%1>]V.)-3rL42{yx5|6`[P$E\n" +
          "o",
        "E[fct7G?]5&F_v'2XMQ=/yBsY4<I`O^bVj%J-!L0*8T~oh:3l;auKgDmAP6SRd(|\"}\\\n" +
          "x+n9pU$NZk.iwr{1@q)Ce,#zWH>",
        'lFK_46?dwkLZ,93>;WGNqvhjSC\\[Y@QX$Un)"Bt*Is2AHR#a/J]~1!\n' +
          "%(m8Trbu-<ypzO|EePfVDiocg:}`+0={.'&7M5^x",
        `>+fg\\D{J'RqABy^@[i"asp:/XHhM;rVScI\n` +
          "|Y}8&O7v2Z!%N3n?LP~CK0FQ]m,z)*tj(l5`oE-bk#W$U6=9Txu4de<.Gw1_",
      ];

      const v1 = aSet;
      const v2 = bSet;
      const v3 = cSet;
      const v4 = dSet;
      const v5 = eSet;
      const v6 = [...v1, ...v2];
      const v7 = [...v1, ...v2, ...v3];
      const v8 = [...v1, ...v2, ...v3, ...v4];
      const v9 = [...v1, ...v2, ...v3, ...v4, ...v5];
      const alphabets = [v1, v2, v3, v4, v5, v6, v7, v8, v9];

      console.log(
        "\nLengths\n\n",
        v1.length,
        v2.length,
        v3.length,
        v4.length,
        v5.length
      );

      const encryptionTags = Array.from(
        { length: 9 },
        (_, i) => `[EN_V${i + 1}]`
      );

      /**
       * Convert a numeric code into a hash value between 1‚Äì9.
       * @param {number|string} code - Input numeric code.
       * @returns {number|null} - A hash between 1‚Äì9, or null if invalid.
       */
      function hashToDigit(code) {
        const str = String(code).padStart(3, "0");
        const num = parseInt(str, 10);
        if (num < 5 || num > 999) return null;

        let hash = 0;
        for (let i = 0; i < str.length; i++) {
          hash = (hash * 31 + str.charCodeAt(i)) % 9;
        }
        return hash + 1;
      }

      /**
       * Encrypts or decrypts a given text using a multi-rotating Caesar cipher.
       * Each encryption appends a unique tag containing a random "magic number"
       * and version identifier, allowing automatic decryption later.
       *
       * @param {string} text - The text to encrypt or decrypt.
       * @param {boolean} [encrypt=true] - If true, encrypts; if false, decrypts.
       * @returns {string} - Encrypted or decrypted text.
       */
      function encryptAndDecrypt(text, encrypt = true) {
        if (typeof text !== "string") return text;
        console.log("Enigma 2.0 start:", { encrypt, text });

        // --- Helper: generate random 3-digit number ---
        function generateMagicNumber() {
          const number = Math.floor(Math.random() * (999 - 5 + 1)) + 5;
          return { string: number.toString().padStart(3, "0"), number };
        }

        let magicNumber,
          resultText = "",
          ENCRYPTION_TAG,
          tagIndex;

        if (!encrypt) {
          // üîç Use regex to extract [XXX[EN_VY]]
          const match = text.match(/\[(\d{3})\[EN_V(\d)\]\]$/);
          if (!match) {
            console.warn("No valid encryption tag found. Skipping decryption.");
            return text;
          }

          const magicStr = match[1];
          const tagNum = parseInt(match[2], 10);
          magicNumber = { string: magicStr, number: -parseInt(magicStr, 10) };
          ENCRYPTION_TAG = `[EN_V${tagNum}]`;
          tagIndex = tagNum - 1;
          text = text.replace(match[0], "");
        } else {
          // üîê Encryption mode
          tagIndex = Math.floor(Math.random() * 9);
          ENCRYPTION_TAG = encryptionTags[tagIndex];
          magicNumber = generateMagicNumber();

          if (text.includes(ENCRYPTION_TAG)) {
            console.log("Text already encrypted:", text);
            return text;
          }
        }

        const alphabetLists = alphabets[tagIndex];
        const totalAlphabets = alphabetLists.length;

        for (let i = 0; i < text.length; i++) {
          const char = text[i];
          const currentAlphabet = alphabetLists[i % totalAlphabets];
          const index = currentAlphabet.indexOf(char);

          if (index !== -1) {
            let newIndex =
              (index + magicNumber.number) % currentAlphabet.length;
            if (newIndex < 0) newIndex += currentAlphabet.length;
            resultText += currentAlphabet[newIndex];
          } else {
            resultText += char;
          }
        }

        if (encrypt) resultText += `[${magicNumber.string}${ENCRYPTION_TAG}]`;

        console.log(`${encrypt ? "Encryption" : "Decryption"} complete.`, {
          resultText,
          magicNumber,
          ENCRYPTION_TAG,
        });

        return resultText;
      }

      /* -------------------------------------------------------------
       * üß≠ UI Controller (DOM Interactions)
       * ------------------------------------------------------------- */

      /**
       * Handles all DOM bindings and user interactions for the Enigma Cipher UI.
       * Provides accessible modal behavior, clipboard utilities, and
       * smart encryption/decryption triggers.
       * @class
       */
      class EnigmaUI {
        constructor() {
          /** @type {HTMLTextAreaElement} */
          this.textInput = document.getElementById("textInput");
          /** @type {HTMLTextAreaElement} */
          this.outputArea = document.getElementById("output");

          /** @type {HTMLButtonElement} */
          this.encryptButton = document.getElementById("encrypt");
          /** @type {HTMLButtonElement} */
          this.decryptButton = document.getElementById("decrypt");
          /** @type {HTMLButtonElement} */
          this.copyButton = document.getElementById("copyButton");
          /** @type {HTMLButtonElement} */
          this.pasteButton = document.getElementById("pasteButton");

          /** @type {HTMLDivElement} */
          this.modal = document.getElementById("helpModal");
          /** @type {HTMLButtonElement} */
          this.infoButton = document.getElementById("infoButton");
          /** @type {HTMLSpanElement} */
          this.closeBtn = document.querySelector(".close");

          /** @type {Boolean} */
          this.modalOpen = false;
          /** @type {HTMLElement|null} The element that opened the modal for focus return. */
          this.lastFocusedElement = null;

          this.bindEvents();
        }

        /** Bind all event listeners for buttons, modal, and accessibility. */
        bindEvents() {
          // --- Core Encryption / Decryption Controls ---
          this.encryptButton.addEventListener("click", () => this.encrypt());
          this.decryptButton.addEventListener("click", () => this.decrypt());
          this.copyButton.addEventListener("click", () => this.copyOutput());
          this.pasteButton.addEventListener("click", () => this.pasteInput());
          this.textInput.addEventListener("dblclick", () => this.autoMode());

          // --- Modal Controls ---
          this.infoButton.addEventListener("click", () => this.openModal());
          this.closeBtn.addEventListener("click", () => this.closeModal());

          // --- Global Click Event (to close modal when clicking outside) ---
          window.addEventListener("click", (event) => {
            if (this.modalOpen && event.target === this.modal) {
              this.closeModal();
            }
          });

          // --- Keyboard Accessibility (ESC key, focus trap) ---
          window.addEventListener("keydown", (event) => {
            if (this.modalOpen) {
              switch (event.key) {
                case "Escape":
                  this.closeModal();
                  break;
                case "Tab":
                  this.trapFocus(event);
                  break;
              }
            }
          });
        }

        /* -------------------------------------------------------------
         * üîê Encryption / Decryption Logic
         * ------------------------------------------------------------- */

        /** Encrypt the current input text and display output. */
        encrypt() {
          const text = this.textInput.value.trim();
          this.outputArea.value = encryptAndDecrypt(text, true);
        }

        /** Decrypt the current input text and display output. */
        decrypt() {
          const text = this.textInput.value.trim();
          this.outputArea.value = encryptAndDecrypt(text, false);
        }

        /** Automatically encrypt or decrypt based on tag presence. */
        autoMode() {
          const text = this.textInput.value;
          if (text.endsWith("]")) this.decrypt();
          else this.encrypt();
        }

        /* -------------------------------------------------------------
         * üìã Clipboard Utilities
         * ------------------------------------------------------------- */

        /** Copy current output to clipboard. */
        async copyOutput() {
          try {
            await navigator.clipboard.writeText(this.outputArea.value);
            console.log("‚úÖ Copied to clipboard.");
          } catch (err) {
            console.error("Clipboard copy failed:", err);
          }
        }

        /** Paste clipboard contents into the input field. */
        async pasteInput() {
          try {
            const text = await navigator.clipboard.readText();
            this.textInput.value = text;
            console.log("üìã Pasted from clipboard.");
          } catch (err) {
            console.error("Clipboard paste failed:", err);
          }
        }

        /* -------------------------------------------------------------
         * üß© Accessibility-Friendly Modal Behavior
         * ------------------------------------------------------------- */

        /**
         * Open the Help Modal with accessibility features.
         * - Focus is trapped within the modal
         * - Background content is visually and semantically hidden
         * - Focus returns to the triggering element on close
         */
        openModal() {
          this.lastFocusedElement = document.activeElement;
          this.modal.style.display = "block";
          this.modal.setAttribute("aria-hidden", "false");
          this.modal.setAttribute("role", "dialog");
          this.modal.setAttribute("aria-modal", "true");
          this.infoButton.style.display = "none";
          this.modalOpen = true;

          // Set initial focus on close button for screen readers
          this.closeBtn.focus();
        }

        /**
         * Close the Help Modal and restore focus.
         * - Returns focus to the last focused element before opening modal
         * - Hides modal content from accessibility tree
         */
        closeModal() {
          this.modal.style.display = "none";
          this.modal.setAttribute("aria-hidden", "true");
          this.infoButton.style.display = "block";
          this.modalOpen = false;

          if (this.lastFocusedElement) {
            this.lastFocusedElement.focus();
          }
        }

        /**
         * Trap focus within the modal when open.
         * Ensures accessibility compliance for keyboard navigation.
         * @param {KeyboardEvent} event - The tab key event.
         */
        trapFocus(event) {
          const focusableElements = this.modal.querySelectorAll(
            'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
          );
          const firstEl = focusableElements[0];
          const lastEl = focusableElements[focusableElements.length - 1];

          if (event.shiftKey) {
            // Shift + Tab cycles backward
            if (document.activeElement === firstEl) {
              lastEl.focus();
              event.preventDefault();
            }
          } else {
            // Tab cycles forward
            if (document.activeElement === lastEl) {
              firstEl.focus();
              event.preventDefault();
            }
          }
        }
      }

      /* -------------------------------------------------------------
       * üöÄ Initialize UI once DOM is ready
       * ------------------------------------------------------------- */
      document.addEventListener("DOMContentLoaded", () => {
        window.enigmaApp = new EnigmaUI();
      });
    </script>
  </body>
</html>
